!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function e(t,r){var a=r.getDefaultValue,n=r.validator,o=r.requiredValidator;i(this,e),this.name=t,this.getDefaultValue=a,this.validator=n,this.requiredValidator=o};t.default=a},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return Array.isArray(e)?e:Array.from(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(3),d=r(2),f=i(d),c=r(0),y=i(c),v={notDefinedKey:function(e){return"Key '"+e+"' is not defined in schema"},modelIsUndefined:function(){return"Validated model is undefined"},validateRequired:function(e){return"Field '"+e+"' is required"},validateString:function(e){return"Field '"+e+"' is not a String"},validateNumber:function(e){return"Field '"+e+"' is not a Number"},validateObject:function(e){return"Field '"+e+"' is not a Object"},validateArray:function(e){return"Field '"+e+"' is not a Array"},validateBoolean:function(e){return"Field '"+e+"' is not a Boolean"},validateDate:function(e){return"Field '"+e+"' is not a Date"}},h=function(){function e(t,r){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n(this,e),this.schema=t,this.errors={},this.promises=[],this.additionalValidators=new Set,this.messages=s({},v,r),this.validateKeys=i,this.validateTypeString=this.validateTypeString.bind(this),this.validateTypeNumber=this.validateTypeNumber.bind(this),this.validateTypeObject=this.validateTypeObject.bind(this),this.validateTypeArray=this.validateTypeArray.bind(this),this.validateTypeBoolean=this.validateTypeBoolean.bind(this),this.validateTypeDate=this.validateTypeDate.bind(this),this.validateTypeSchema=this.validateTypeSchema.bind(this),this.validateRequiredType=this.validateRequiredType.bind(this),this.validateRequiredTypeObject=this.validateRequiredTypeObject.bind(this),this.validateRequiredTypeDate=this.validateRequiredTypeDate.bind(this),this.validateRequiredTypeNumber=this.validateRequiredTypeNumber.bind(this),this.validateRequiredTypeArray=this.validateRequiredTypeArray.bind(this),this.typesValidators={String:this.validateTypeString,Number:this.validateTypeNumber,Object:this.validateTypeObject,Array:this.validateTypeArray,Boolean:this.validateTypeBoolean,Date:this.validateTypeDate},this.typesRequiredValidators={String:this.validateRequiredType,Number:this.validateRequiredTypeNumber,Object:this.validateRequiredTypeObject,Array:this.validateRequiredTypeArray,Boolean:this.validateRequiredType,Date:this.validateRequiredTypeDate}}return u(e,null,[{key:"oneOfTypes",value:function(e){return new f.default(e)}},{key:"optionalType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=(0,l.getFieldType)({type:e}),i=r.name,a=void 0===i?"Type":i;return new y.default("Optional"+a+t,{getDefaultValue:function(){},validator:function(t,r,i){return null===t||void 0===t||this.validateType(e,t,r,i)},requiredValidator:function(t,r){return this.validateRequired({type:e,required:!0},t,r),!0}})}}]),u(e,[{key:"getDefaultValues",value:function(){var t=this,r=Object.keys(this.schema),i={};return r.forEach(function(r){var a=t.getField(r),n=Array.isArray(a.type),o=(0,l.getFieldType)(a);if(!a.disableDefaultValue)return void 0!==a.defaultValue?void(i[r]=(0,l.wrapToArray)(a.defaultValue,n)):a.options?void(i[r]=(0,l.wrapToArray)((0,l.getDefaultValueFromOptions)(a.options),n)):o instanceof e?void(i[r]=(0,l.wrapToArray)(o.getDefaultValues(),n)):void(i[r]=(0,l.getDefaultValueForType)(o,n))}),i}},{key:"getField",value:function(e){return s({},this.schema[e],{parentSchema:this})}},{key:"getFields",value:function(){return this.schema}},{key:"validate",value:function(e){var t=this;return this.errors={},this.promises=[],this.checkModel(e)&&(this.checkKeysDiff(e),this.checkTypesAndValidators(e)),this.promises.length>0?Promise.all(this.promises).then(function(){return t.errors}):this.errors}},{key:"setError",value:function(e,t,r){this.errors[e]||(this.errors[e]=[]);var i="function"==typeof t?t():t;if(r>-1)return void(this.errors[e][r]=(0,l.mergeErrors)(this.errors[e][r],i));this.errors[e].push(i)}},{key:"setModelError",value:function(t,r){var i=r,n=t.split("."),o=a(n),s=o[0],u=o.slice(1),d=(0,l.getErrorIndexFromKeys)(u),f=this.getField(s),c=(0,l.getFieldType)(f);if(c instanceof e){var y=new e(c.schema),v=(0,l.removeFirstKeyIfNumber)(u).join(".");y.setModelError(v,r),i=y.errors}this.setError(s,i,d)}},{key:"checkModel",value:function(e){return!!e||(this.setError("model",this.messages.modelIsUndefined()),!1)}},{key:"checkKeysDiff",value:function(e){var t=this;if(this.validateKeys){var r=Object.keys(e),i=Object.keys(this.schema),a=(0,l.arraysDifference)(r,i);a.length>0&&a.forEach(function(e){t.setError(e,t.messages.notDefinedKey(e))})}}},{key:"checkTypesAndValidators",value:function(e){var t=this,r=Object.keys(this.schema),i=(0,l.pick)(e,r);r.forEach(function(e){var r=i[e],a=t.schema[e],n=t.getFieldValidators(e),o=Array.isArray(a.type),s=o?a.type[0]:a.type;o&&t.validateType(Array,r)?r.forEach(function(r,i){t.validateType(s,r,e,i)}):t.validateType(s,r,e),t.validateRequired(a,r,e),t.validateCustomValidators({validators:n,value:r,fieldSchema:a,validatedObject:i,key:e})}),this.validateAdditionalValidators(e)}},{key:"resolveValidatorErrorsForKey",value:function(e,t,r){var i=this;return"boolean"!=typeof r||r?Array.isArray(r)?void r.forEach(function(r){i.resolveValidatorErrorsForKey(e,t,r)}):void("string"==typeof r&&this.resolveValidatorErrorsForKey(e,r,!1)):void this.setError(e,t)}},{key:"validateCustomValidators",value:function(e){var t=this,r=e.validators,i=e.value,a=e.fieldSchema,n=e.validatedObject,o=e.key;r.forEach(function(e){var r=e.validator,s=e.errorMessage,u=r(i,a,n,t);if(u instanceof Promise){var l=u.then(function(e){t.resolveValidatorErrorsForKey(o,s,e)});return void t.promises.push(l)}t.resolveValidatorErrorsForKey(o,s,u)})}},{key:"validateAdditionalValidators",value:function(e){var t=this;this.additionalValidators.forEach(function(r){var i=r(e,t);i instanceof Promise&&t.promises.push(i)})}},{key:"validateRequired",value:function(t,r,i){if(t.required){var a=t.type.name;if("function"==typeof this.typesRequiredValidators[a])return void this.typesRequiredValidators[a](r,i);if(t.type instanceof e)return void this.validateRequiredTypeSchema(t.type.schema,r,i);this.validateRequiredType(r,i)}}},{key:"validateRequiredType",value:function(e,t){if(!e||0===e.length){var r=this.getField(t),i=r.label;this.setError(t,this.messages.validateRequired(i||t))}}},{key:"validateRequiredTypeObject",value:function(e,t){if(!("object"===(void 0===e?"undefined":o(e))&&null!==e&&Object.keys(e).length>0)){var r=this.getField(t),i=r.label;this.setError(t,this.messages.validateRequired(i||t))}}},{key:"validateRequiredTypeArray",value:function(e,t){if(!(Array.isArray(e)&&e.length>0)){var r=this.getField(t),i=r.label;this.setError(t,this.messages.validateRequired(i||t))}}},{key:"validateRequiredTypeNumber",value:function(e,t){if("number"!=typeof e||Number.isNaN(e)){var r=this.getField(t),i=r.label;this.setError(t,this.messages.validateRequired(i||t))}}},{key:"validateRequiredTypeDate",value:function(e,t){if(!(e instanceof Date)){var r=this.getField(t),i=r.label;this.setError(t,this.messages.validateRequired(i||t))}}},{key:"validateRequiredTypeSchema",value:function(e,t,r){if("object"===(void 0===t?"undefined":o(t))&&null!==t){var i=!0,a=Object.keys(t);if(Object.keys(e).forEach(function(e){a.indexOf(e)<0&&(i=!1)}),i)return}var n=this.getField(r),s=n.label;this.setError(r,this.messages.validateRequired(s||r))}},{key:"validateType",value:function(t,r,i,a){var n=(0,l.getFunctionName)(t);if(this.registerTypeIfNotExists(t,n),"function"==typeof this.typesValidators[n])return this.typesValidators[n](r,i,t,a);if(t instanceof e)return this.validateTypeSchema(r,i,t,a);if(t instanceof f.default)return this.validateOneOfTypes(r,i,t,a);throw new Error("Unrecognized type "+n)}},{key:"validateTypeString",value:function(e,t,r){if("string"==typeof e)return!0;var i=this.getField(t),a=i.label;return this.setError(t,this.messages.validateString(a||t),r),!1}},{key:"validateTypeNumber",value:function(e,t,r){if("number"==typeof e)return!0;var i=this.getField(t),a=i.label;return this.setError(t,this.messages.validateNumber(a||t),r),!1}},{key:"validateTypeObject",value:function(e,t,r){if("object"===(void 0===e?"undefined":o(e))&&!Array.isArray(e)&&null!==e)return!0;var i=this.getField(t),a=i.label;return this.setError(t,this.messages.validateObject(a||t),r),!1}},{key:"validateTypeArray",value:function(e,t,r){if(Array.isArray(e))return!0;var i=this.getField(t),a=i.label;return this.setError(t,this.messages.validateArray(a||t),r),!1}},{key:"validateTypeBoolean",value:function(e,t,r){if("boolean"==typeof e)return!0;var i=this.getField(t),a=i.label;return this.setError(t,this.messages.validateBoolean(a||t),r),!1}},{key:"validateTypeDate",value:function(e,t,r){if(e instanceof Date)return!0;var i=this.getField(t),a=i.label;return this.setError(t,this.messages.validateDate(a||t),r),!1}},{key:"validateTypeSchema",value:function(e,t,r,i){var a=r.validate(e);return 0===Object.keys(a).length||(this.setError(t,a,i),!1)}},{key:"validateOneOfTypes",value:function(t,r,i,a){var n=new e(i.getSchema()),o=n.validate(i.parseValue(t));return Object.keys(o).length<i.getTypes().length||(this.setError(r,o,a),!1)}},{key:"pick",value:function(e){var t=this,r={};return e.forEach(function(e){r[e]=t.schema[e]}),r}},{key:"omit",value:function(e){var t=this,r={};return Object.keys(this.schema).forEach(function(i){e.indexOf(i)>-1||(r[i]=t.schema[i])}),r}},{key:"extend",value:function(e){var t=this;Object.keys(e).forEach(function(r){t.schema[r]=e[r]})}},{key:"getFieldValidators",value:function(e){return this.schema[e].validators||[]}},{key:"setFieldValidator",value:function(e,t){Array.isArray(this.schema[e].validators)||(this.schema[e].validators=[]),this.schema[e].validators.push(t)}},{key:"extendFieldValidators",value:function(e,t){var r=this.getFieldValidators(e);if(!r.length)return void this.setFieldValidator(e,t);r.indexOf(t)>-1||t.id&&r.findIndex(function(e){return e.id===t.id})>-1||this.setFieldValidator(e,t)}},{key:"registerTypeIfNotExists",value:function(e,t){e instanceof y.default&&"function"!=typeof this.typesValidators[t]&&this.registerType(e)}},{key:"registerType",value:function(e){var t=e.name,r=e.validator,i=e.requiredValidator;this.typesValidators[t]=r.bind(this),i&&(this.typesRequiredValidators[t]=i.bind(this))}},{key:"addValidator",value:function(e){"function"==typeof e&&this.additionalValidators.add(e)}},{key:"removeValidator",value:function(e){this.additionalValidators.delete(e)}}]),e}();t.default=h},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t){i(this,e),this.types=t}return a(e,[{key:"getTypes",value:function(){return this.types||[]}},{key:"parseValue",value:function(e){var t={};return this.getTypes().forEach(function(r,i){t["type"+i]=e}),t}},{key:"getSchema",value:function(){var e={};return this.getTypes().forEach(function(t,r){e["type"+r]={type:t,required:!0}}),e}}]),e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){var r=[],i=!0,a=!1,n=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);i=!0);}catch(e){a=!0,n=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw n}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=(t.pick=function(e,t){var r={};return t.forEach(function(t){r[t]=e[t]}),r},t.arraysDifference=function(e,t){var r=[];return e.forEach(function(e){t.indexOf(e)<0&&r.push(e)}),r},t.wrapToArray=function(e,t){return t&&!Array.isArray(e)?[e]:e}),o=(t.getFieldType=function(e){return Array.isArray(e.type)?e.type[0]:e.type},t.getDefaultValueForType=function(e,t){return"function"==typeof e.getDefaultValue?n(e.getDefaultValue(),t):e===Number?n(NaN,t):e===Date?n(new Date,t):n(e(),t)},t.getDefaultValueFromOptions=function(e){var t=a(e,1),r=t[0];return"object"===(void 0===r?"undefined":i(r))?r.value:r},t.getFunctionName=function(e){var t=e.name;if("function"==typeof e&&!t){var r=e.toString();return r.substr(0,r.indexOf("(")).replace("function ","").trim()}return t},t.isNaN=function(e){return"number"==typeof e&&e!==e}),s=(t.removeFirstKeyIfNumber=function(e){var t=parseInt(e[0],10);return o(t)||e.splice(0,1),e},t.getErrorIndexFromKeys=function(e){var t=parseInt(e[0],10);return o(t)?-1:t},function(e){return null===e||"object"===(void 0===e?"undefined":i(e))&&!Array.isArray(e)&&0===Object.keys(e).length}),u=function(e){return Array.isArray(e)||"string"==typeof e||void 0===e},l=function(e){return null===e?[]:Array.isArray(e)?e:"string"==typeof e?[e]:Object.keys(e).length?[e]:[]},d=function(e,t){for(var r=[],i=Math.max(e.length,t.length),a=0;a<i;a+=1){var n=t[a]||e[a];n&&!s(n)&&(r[a]=n)}return r},f=function(e,t){var r={},i=new Set;return s(e)||Object.keys(e).forEach(function(e){return i.add(e)}),s(t)||Object.keys(t).forEach(function(e){return i.add(e)}),i.forEach(function(i){var a=e[i]||[],n=t[i]||[];r[i]=c(a,n)}),r},c=t.mergeErrors=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(e)&&s(t)?{}:u(e)||u(t)?d(l(e),l(t)):f(e,t)}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(0);Object.defineProperty(t,"SchemaType",{enumerable:!0,get:function(){return i(a).default}});var n=r(1);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i(n).default}})}])});